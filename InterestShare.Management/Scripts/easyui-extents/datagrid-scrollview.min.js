$.extend($.fn.datagrid.defaults,{onBeforeFetch:function(){},onFetch:function(){}});var scrollview=$.extend({},$.fn.datagrid.defaults.view,{render:function(n,t,i){var l=$.data(n,"datagrid"),u=l.options,o=this.rows||[],h,f,r,e;if(o.length&&(h=$(n).datagrid("getColumnFields",i),!i||u.rownumbers||u.frozenColumns&&u.frozenColumns.length)){for(f=this.index,r=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'],e=0;e<o.length;e++){var s=u.rowStyler?u.rowStyler.call(n,f,o[e]):"",a="",c="";typeof s=="string"?c=s:s&&(a=s["class"]||"",c=s.style||"");var v='class="datagrid-row '+(f%2&&u.striped?"datagrid-row-alt ":" ")+a+'"',y=c?'style="'+c+'"':"",p=l.rowIdPrefix+"-"+(i?1:2)+"-"+f;r.push('<tr id="'+p+'" datagrid-row-index="'+f+'" '+v+" "+y+">");r.push(this.renderRow.call(this,n,h,i,f,o[e]));r.push("<\/tr>");u.detailFormatter&&(r.push('<tr style="display:none;">'),i?r.push("<td colspan="+(h.length+2)+' style="border-right:0">'):r.push("<td colspan="+h.length+">"),r.push('<div class="datagrid-row-detail">'),i?r.push("&nbsp;"):r.push(u.detailFormatter.call(n,e,o[e])),r.push("<\/div>"),r.push("<\/td>"),r.push("<\/tr>"));f++}r.push("<\/tbody><\/table>");$(t).html(r.join(""))}},renderRow:function(n,t,i,r,u){var s=$.data(n,"datagrid").options,e=[],y,a,c,f,w,o;for(i&&s.rownumbers&&(y=r+1,s.pagination&&(y+=(s.pageNumber-1)*s.pageSize),e.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">'+y+"<\/div><\/td>")),a=0;a<t.length;a++)if(c=t[a],f=$(n).datagrid("getColumnOption",c),f){var l=u[c],v=f.styler?f.styler(l,u,r)||"":"",p="",h="";typeof v=="string"?h=v:e&&(p=v["class"]||"",h=v.style||"");w=p?'class="'+p+'"':"";o=f.hidden?'style="display:none;'+h+'"':h?'style="'+h+'"':"";e.push('<td field="'+c+'" '+w+" "+o+">");f.checkbox?o="":f.expander?o="text-align:center;height:16px;":(o=h,f.align&&(o+=";text-align:"+f.align+";"),s.nowrap?s.autoRowHeight&&(o+=";height:auto;"):o+=";white-space:normal;height:auto;");e.push('<div style="'+o+'" ');f.checkbox?e.push('class="datagrid-cell-check '):e.push('class="datagrid-cell '+f.cellClass);e.push('">');f.checkbox?e.push('<input type="checkbox" name="'+c+'" value="'+(l!=undefined?l:"")+'">'):f.expander?e.push('<span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:16px;height:16px;cursor:pointer;" />'):f.formatter?e.push(f.formatter(l,u,r)):e.push(l);e.push("<\/div>");e.push("<\/td>")}return e.join("")},bindEvents:function(n){var i=$.data(n,"datagrid"),r=i.dc,f=i.options,t=r.body1.add(r.body2),u=($.data(t[0],"events")||$._data(t[0],"events")).click[0].handler;t.unbind("click").bind("click",function(t){var i=$(t.target),f=i.closest("tr.datagrid-row"),r;f.length&&(i.hasClass("datagrid-row-expander")?(r=parseInt(f.attr("datagrid-row-index")),i.hasClass("datagrid-row-expand")?$(n).datagrid("expandRow",r):$(n).datagrid("collapseRow",r),$(n).datagrid("fixRowHeight")):u(t),t.stopPropagation())})},onBeforeRender:function(n){function f(){r.onLoadSuccess=t.onLoadSuccess;t.onLoadSuccess=function(){};setTimeout(function(){i.body2.unbind(".datagrid").bind("scroll.datagrid",function(){r.onLoadSuccess&&(t.onLoadSuccess=r.onLoadSuccess,r.onLoadSuccess=undefined);u.scrollTimer&&clearTimeout(u.scrollTimer);u.scrollTimer=setTimeout(function(){e.call(u)},50)});i.body2.triggerHandler("scroll.datagrid")},0)}function e(){function s(){var u=$(i.body2).scrollTop(),f=Math.floor(u/25),r=Math.floor(f/t.pageSize)+1;this.getRows.call(this,n,r,function(u){this.index=(r-1)*t.pageSize;this.rows=u;this.r1=u;this.r2=[];this.populate.call(this,n);i.body2.triggerHandler("scroll.datagrid")})}var r;if(i.body2.is(":empty"))s.call(this);else{var h=t.finder.getTr(n,this.index,"body",2),u=t.finder.getTr(n,0,"last",2),f=i.view2.children("div.datagrid-header").outerHeight(),e=h.position().top-f,o=u.position().top+u.outerHeight()-f;e>i.body2.height()||o<0?s.call(this):e>0?(r=Math.floor(this.index/t.pageSize),this.getRows.call(this,n,r,function(i){this.r2=this.r1;this.r1=i;this.index=(r-1)*t.pageSize;this.rows=this.r1.concat(this.r2);this.populate.call(this,n)})):o<i.body2.height()&&(r=Math.floor(this.index/t.pageSize)+2,this.r2.length&&r++,this.getRows.call(this,n,r,function(i){this.r2.length?(this.r1=this.r2,this.r2=i,this.index+=t.pageSize):this.r2=i;this.rows=this.r1.concat(this.r2);this.populate.call(this,n)}))}}function o(){var f,h,r,e;if(t.detailFormatter){var r=$(n),o=!1,s=r.datagrid("getColumnFields",!0).concat(r.datagrid("getColumnFields"));for(f=0;f<s.length;f++)if(h=r.datagrid("getColumnOption",s[f]),h.expander){o=!0;break}o||(t.frozenColumns&&t.frozenColumns.length?t.frozenColumns[0].splice(0,0,{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}):t.frozenColumns=[[{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}]],r=i.view1.children("div.datagrid-header").find("table"),e=$('<td rowspan="'+t.frozenColumns.length+'"><div class="datagrid-header-expander" style="width:24px;"><\/div><\/td>'),$("tr",r).length==0?e.wrap("<tr><\/tr>").parent().appendTo($("tbody",r)):t.rownumbers?e.insertAfter(r.find("td:has(div.datagrid-header-rownumber)")):e.prependTo(r.find("tr:first")));setTimeout(function(){u.bindEvents(n)},0)}}var r=$.data(n,"datagrid"),t=r.options,i=r.dc,u=this;r.data.firstRows=r.data.rows;t.finder=$.extend({},$.fn.datagrid.defaults.finder,{getRow:function(n,t){var u=typeof t=="object"?t.attr("datagrid-row-index"):t,i=$.data(n,"datagrid").data.rows[u],r;return i||(r=$(n).datagrid("options").view,i=r.rows[u-r.index]),i}});i.body1.add(i.body2).empty();this.rows=undefined;this.r1=this.r2=[];f();o()},onAfterRender:function(n){$.fn.datagrid.defaults.view.onAfterRender.call(this,n);var t=$.data(n,"datagrid").dc,i=t.footer1.add(t.footer2);i.find("span.datagrid-row-expander").css("visibility","hidden")},getRows:function(n,t,i){var u=$.data(n,"datagrid"),r=u.options,o=(t-1)*r.pageSize,f,e,s;if(r.onBeforeFetch.call(n,t)!=!1)if(f=u.data.firstRows.slice(o,o+r.pageSize),f.length)r.onFetch.call(n,t,f),i.call(this,f);else{if(e=$.extend({},r.queryParams,{page:t,rows:r.pageSize}),r.sortName&&$.extend(e,{sort:r.sortName,order:r.sortOrder}),r.onBeforeLoad.call(n,e)==!1)return;$(n).datagrid("loading");s=r.loader.call(n,e,function(u){$(n).datagrid("loaded");var u=r.loadFilter.call(n,u);r.onFetch.call(n,t,u.rows);u.rows&&u.rows.length?i.call(r.view,u.rows):r.onLoadSuccess.call(n,u)},function(){$(n).datagrid("loaded");r.onLoadError.apply(n,arguments)});s==!1&&($(n).datagrid("loaded"),u.data.firstRows.length||(r.onFetch.call(n,t,u.data.firstRows),r.onLoadSuccess.call(n,u.data)))}},populate:function(n){var t=$.data(n,"datagrid"),i=t.options,r=t.dc,u=25,f,e;if(this.rows.length){for(i.view.render.call(i.view,n,r.body2,!1),i.view.render.call(i.view,n,r.body1,!0),r.body1.add(r.body2).children("table.datagrid-btable").css({marginTop:this.index*u,marginBottom:t.data.total*u-this.rows.length*u-this.index*u}),f=[],e=0;e<this.index;e++)f.push({});t.data.rows=f.concat(this.rows);i.onLoadSuccess.call(n,{total:t.data.total,rows:this.rows})}}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(n,t){return n.each(function(){var u=$.data(this,"datagrid").options,f=$.data(this,"datagrid").dc,i=u.finder.getTr(this,t,"body",1).next(),n=u.finder.getTr(this,t,"body",2).next(),r;n.is(":visible")&&(i.css("height",""),n.css("height",""),r=Math.max(i.height(),n.height()),i.css("height",r),n.css("height",r));f.body2.triggerHandler("scroll")})},getExpander:function(n,t){var i=$.data(n[0],"datagrid").options;return i.finder.getTr(n[0],t).find("span.datagrid-row-expander")},getRowDetail:function(n,t){var i=$.data(n[0],"datagrid").options,r=i.finder.getTr(n[0],t,"body",2);return r.next().find("div.datagrid-row-detail")},expandRow:function(n,t){return n.each(function(){var n=$(this).datagrid("options"),e=$.data(this,"datagrid").dc,i=$(this).datagrid("getExpander",t),r,u,f;i.hasClass("datagrid-row-expand")&&(i.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse"),r=n.finder.getTr(this,t,"body",1).next(),u=n.finder.getTr(this,t,"body",2).next(),r.show(),u.show(),$(this).datagrid("fixDetailRowHeight",t),n.onExpandRow&&(f=$(this).datagrid("getRows")[t],n.onExpandRow.call(this,t,f)))})},collapseRow:function(n,t){return n.each(function(){var n=$(this).datagrid("options"),e=$.data(this,"datagrid").dc,i=$(this).datagrid("getExpander",t),r,u,f;i.hasClass("datagrid-row-collapse")&&(i.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand"),r=n.finder.getTr(this,t,"body",1).next(),u=n.finder.getTr(this,t,"body",2).next(),r.hide(),u.hide(),e.body2.triggerHandler("scroll"),n.onCollapseRow&&(f=$(this).datagrid("getRows")[t],n.onCollapseRow.call(this,t,f)))})}});
/*
//# sourceMappingURL=datagrid-scrollview.min.js.map
*/