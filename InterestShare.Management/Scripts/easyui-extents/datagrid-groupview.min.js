var groupview=$.extend({},$.fn.datagrid.defaults.view,{render:function(n,t,i){for(var u=[],f=this.groups,r=0;r<f.length;r++)u.push(this.renderGroup.call(this,n,r,f[r],i));$(t).html(u.join(""))},renderGroup:function(n,t,i,r){var c=$.data(n,"datagrid"),f=c.options,a=$(n).datagrid("getColumnFields",r),u=[],e,o;for(u.push('<div class="datagrid-group" group-index='+t+">"),u.push('<table cellspacing="0" cellpadding="0" border="0" style="height:100%"><tbody>'),u.push("<tr>"),(!r||!(f.rownumbers||f.frozenColumns.length))&&(r||f.rownumbers||f.frozenColumns.length)||u.push('<td style="border:0;text-align:center;width:25px"><span class="datagrid-row-expander datagrid-row-collapse" style="display:inline-block;width:16px;height:16px;cursor:pointer">&nbsp;<\/span><\/td>'),u.push('<td style="border:0;">'),r||(u.push('<span class="datagrid-group-title">'),u.push(f.groupFormatter.call(n,i.value,i.rows)),u.push("<\/span>")),u.push("<\/td>"),u.push("<\/tr>"),u.push("<\/tbody><\/table>"),u.push("<\/div>"),u.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'),e=i.startIndex,o=0;o<i.rows.length;o++){var s=f.rowStyler?f.rowStyler.call(n,e,i.rows[o]):"",l="",h="";typeof s=="string"?h=s:s&&(l=s["class"]||"",h=s.style||"");var v='class="datagrid-row '+(e%2&&f.striped?"datagrid-row-alt ":" ")+l+'"',y=h?'style="'+h+'"':"",p=c.rowIdPrefix+"-"+(r?1:2)+"-"+e;u.push('<tr id="'+p+'" datagrid-row-index="'+e+'" '+v+" "+y+">");u.push(this.renderRow.call(this,n,a,r,e,i.rows[o]));u.push("<\/tr>");e++}return u.push("<\/tbody><\/table>"),u.join("")},bindEvents:function(n){var r=$.data(n,"datagrid"),i=r.dc,t=i.body1.add(i.body2),u=($.data(t[0],"events")||$._data(t[0],"events")).click[0].handler;t.unbind("click").bind("click",function(t){var f=$(t.target),i=f.closest("span.datagrid-row-expander"),r;i.length?(r=i.closest("div.datagrid-group").attr("group-index"),i.hasClass("datagrid-row-collapse")?$(n).datagrid("collapseGroup",r):$(n).datagrid("expandGroup",r)):u(t);t.stopPropagation()})},onBeforeRender:function(n,t){function l(n){for(var i,t=0;t<u.length;t++)if(i=u[t],i.value==n)return i;return null}function a(){$("#datagrid-group-style").length||$("head").append('<style id="datagrid-group-style">.datagrid-group{height:25px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;}<\/style>')}var s=$.data(n,"datagrid"),h=s.options,u,f,o,e,r,i,c;for(a(),u=[],r=0;r<t.length;r++)f=t[r],i=l(f[h.groupField]),i?i.rows.push(f):(i={value:f[h.groupField],rows:[f]},u.push(i));for(o=0,e=[],r=0;r<u.length;r++)i=u[r],i.startIndex=o,o+=i.rows.length,e=e.concat(i.rows);s.data.rows=e;this.groups=u;c=this;setTimeout(function(){c.bindEvents(n)},0)}});$.extend($.fn.datagrid.methods,{expandGroup:function(n,t){return n.each(function(){var r=$.data(this,"datagrid").dc.view,n=r.find(t!=undefined?'div.datagrid-group[group-index="'+t+'"]':"div.datagrid-group"),i=n.find("span.datagrid-row-expander");i.hasClass("datagrid-row-expand")&&(i.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse"),n.next("table").show());$(this).datagrid("fixRowHeight")})},collapseGroup:function(n,t){return n.each(function(){var r=$.data(this,"datagrid").dc.view,n=r.find(t!=undefined?'div.datagrid-group[group-index="'+t+'"]':"div.datagrid-group"),i=n.find("span.datagrid-row-expander");i.hasClass("datagrid-row-collapse")&&(i.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand"),n.next("table").hide());$(this).datagrid("fixRowHeight")})}});$.extend(groupview,{refreshGroupTitle:function(n,t){var i=$.data(n,"datagrid"),u=i.options,f=i.dc,r=this.groups[t],e=f.body2.children("div.datagrid-group[group-index="+t+"]").find("span.datagrid-group-title");e.html(u.groupFormatter.call(n,r.value,r.rows))},insertRow:function(n,t,i){function h(t,i){var r=i?1:2,u=o.finder.getTr(n,t-1,"body",r),f=o.finder.getTr(n,t,"body",r);f.insertAfter(u)}for(var u=$.data(n,"datagrid"),o=u.options,s=u.dc,r=null,f,e=0;e<this.groups.length;e++)if(this.groups[e].value==i[o.groupField]){r=this.groups[e];f=e;break}r?((t==undefined||t==null)&&(t=u.data.rows.length),t<r.startIndex?t=r.startIndex:t>r.startIndex+r.rows.length&&(t=r.startIndex+r.rows.length),$.fn.datagrid.defaults.view.insertRow.call(this,n,t,i),t>=r.startIndex+r.rows.length&&(h(t,!0),h(t,!1)),r.rows.splice(t-r.startIndex,0,i)):(r={value:i[o.groupField],rows:[i],startIndex:u.data.rows.length},f=this.groups.length,s.body1.append(this.renderGroup.call(this,n,f,r,!0)),s.body2.append(this.renderGroup.call(this,n,f,r,!1)),this.groups.push(r),u.data.rows.push(i));this.refreshGroupTitle(n,f)},updateRow:function(n,t,i){var f=$.data(n,"datagrid").options,r,u;$.fn.datagrid.defaults.view.updateRow.call(this,n,t,i);r=f.finder.getTr(n,t,"body",2).closest("table.datagrid-btable");u=parseInt(r.prev().attr("group-index"));this.refreshGroupTitle(n,u)},deleteRow:function(n,t){var f=$.data(n,"datagrid"),s=f.options,e=f.dc,o=e.body1.add(e.body2),h=s.finder.getTr(n,t,"body",2).closest("table.datagrid-btable"),u=parseInt(h.prev().attr("group-index")),t,i,r;if($.fn.datagrid.defaults.view.deleteRow.call(this,n,t),r=this.groups[u],r.rows.length>1)r.rows.splice(t-r.startIndex,1),this.refreshGroupTitle(n,u);else{for(o.children("div.datagrid-group[group-index="+u+"]").remove(),i=u+1;i<this.groups.length;i++)o.children("div.datagrid-group[group-index="+i+"]").attr("group-index",i-1);this.groups.splice(u,1)}for(t=0,i=0;i<this.groups.length;i++)r=this.groups[i],r.startIndex=t,t+=r.rows.length}});
/*
//# sourceMappingURL=datagrid-groupview.min.js.map
*/